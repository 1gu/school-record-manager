<canvas id='<%= "bar#{term}" %>' class="graph"></canvas>

<%= javascript_tag do %>
  var barChartData = {
   labels : <%= raw subjects.map { |subject| subject.name } %>,
   datasets : [
     {
       fillColor : "rgba(151,187,205,0.5)",
       strokeColor : "rgba(151,187,205,1)",
       data : <%= raw subjects.map{ |subject| subject.records.find_by(user: current_user, term: term).test_score } %>
     }
   ]
  }
  var bar_graph = new Chart(document.getElementById('<%= "bar#{term}" %>').getContext("2d")).Bar(barChartData);
  var bars_count = bar_graph.datasets[0].bars.length;
  for (var i = 0; i < bars_count; i++){
   var bar = bar_graph.datasets[0].bars[i];
   if (bar.value < 60) {
     bar.fillColor = "rgba(191, 63, 63, 0.7)";
     bar.strokeColor = "rgba(189, 55, 55, 0.7)";
   }
  }
<% end %>
